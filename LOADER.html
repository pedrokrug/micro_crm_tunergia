<!--
   TUNERGIA INTERFACE LOADER - COMPLETE VERSION
   ============================================
   Paste this into your Odoo website/HTML field.

   Repository: pedrokrug/micro_crm_tunergia
   Branch: claude/refactor-crm-code-blocks-K3Cix
   Version: 1.0.9
-->

<div class="tunergia-dashboard">

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">Cargando datos del dashboard...</p>
    </div>

    <!-- Error banner -->
    <div class="error-banner" id="errorBanner">
        <span class="error-icon">‚ö†Ô∏è</span>
        <span class="error-text" id="errorBannerText">Ha ocurrido un error al cargar los datos.</span>
    </div>

    <!-- User banner -->
    <div class="user-banner" id="userBanner">
        <div class="user-info">
            <div class="user-avatar" id="userAvatar">--</div>
            <div class="user-details">
                <h3 id="userName">Cargando...</h3>
                <p id="userEmail">Cargando informaci√≥n del usuario...</p>
            </div>
        </div>
        <div class="user-id-badge" id="userIdBadge">ID: ---</div>
    </div>

    <!-- Dashboard header -->
    <div class="dashboard-header">
        <div class="header-left">
            <h1>Bienvenido, <span id="welcomeName">Usuario</span></h1>
            <p>Gestiona tus contratos, centraliza tu informaci√≥n y haz comparativas</p>
        </div>
        <div class="header-right">
            <div class="alert-badge">
                <span class="alert-icon">‚ö°</span>
                <span>¬°Atenci√≥n! Nuevas actualizaciones de precio disponibles</span>
            </div>
            <button class="notification-btn" title="Notificaciones">üîî</button>
        </div>
    </div>

    <!-- Date filter buttons -->
    <div class="date-filters">
        <div class="filter-buttons">
            <button class="filter-btn" data-days="365">12 meses</button>
            <button class="filter-btn" data-days="180">6 meses</button>
            <button class="filter-btn active" data-days="30">30 d√≠as</button>
            <button class="filter-btn" data-days="7">7 d√≠as</button>
        </div>
        <span style="font-size: 12px; color: #718096;">‚Üê Filtro para estad√≠sticas</span>
    </div>

    <!-- Stats grid - Row 1 -->
    <div class="stats-grid" style="margin-bottom: 12px;">
        <div class="stat-card centered">
            <div class="stat-label">Contratos En Tramitaci√≥n</div>
            <div class="stat-value-centered">
                <span id="statTramitados">--</span>
            </div>
            <div class="stat-change neutral" id="changeTramitados">
                <span class="change-icon">‚è≥</span>
                <span>pendientes actualmente</span>
            </div>
        </div>

        <div class="stat-card centered">
            <div class="stat-label">Contratos Activados</div>
            <div class="stat-value-centered">
                <span id="statActivados">--</span>
            </div>
            <div class="stat-change positive" id="changeActivados">
                <span class="change-icon">‚Üë</span>
                <span>--% vs per√≠odo anterior</span>
            </div>
        </div>

        <div class="stat-card centered">
            <div class="stat-label">Contratos Bajas</div>
            <div class="stat-value-centered">
                <span id="statBajas">--</span>
            </div>
            <div class="stat-change negative" id="changeBajas">
                <span class="change-icon">‚Üì</span>
                <span>--% vs per√≠odo anterior</span>
            </div>
        </div>
    </div>

    <!-- Stats grid - Row 2 -->
    <div class="stats-grid">
        <div class="stat-card centered">
            <div class="stat-label">kWh En Tramitaci√≥n</div>
            <div class="stat-value-centered">
                <span id="statKwhTramitacion">--</span>
            </div>
            <div class="stat-change neutral" id="changeKwhTramitacion">
                <span class="change-icon">‚è≥</span>
                <span>pendiente</span>
            </div>
        </div>

        <div class="stat-card centered">
            <div class="stat-label">kWh Activados</div>
            <div class="stat-value-centered">
                <span id="statKwhActivados">--</span>
            </div>
            <div class="stat-change positive" id="changeKwhActivados">
                <span class="change-icon">‚ö°</span>
                <span>--% vs per√≠odo anterior</span>
            </div>
        </div>

        <div class="stat-card centered">
            <div class="stat-label">kWh Bajas</div>
            <div class="stat-value-centered">
                <span id="statKwhBajas">--</span>
            </div>
            <div class="stat-change negative" id="changeKwhBajas">
                <span class="change-icon">‚Üì</span>
                <span>--% vs per√≠odo anterior</span>
            </div>
        </div>
    </div>

    <!-- Contracts section -->
    <div class="contracts-section">
        <div class="contracts-header">
            <div class="contracts-title">
                <div>
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <h2>Todos tus Contratos</h2>
                        <span class="contracts-count" id="totalContracts">0 Contratos</span>
                        <span class="contracts-count" id="filteredCount" style="display: none; background: #fef3c7; color: #92400e;"></span>
                    </div>
                    <p>Listado completo de tus clientes y contratos.</p>
                </div>
            </div>
            <div class="contracts-actions">
                <div id="selectionInfo" style="display: none; align-items: center; gap: 8px; padding: 8px 12px; background: #ebf8ff; border-radius: 6px; margin-right: 8px;">
                    <span id="selectedCount" style="font-weight: 600; color: #2b6cb0;">0 seleccionados</span>
                    <button id="selectAllContracts" class="action-btn" style="padding: 4px 8px; font-size: 11px; display: none;">
                        Seleccionar todos los <span id="selectAllCount">0</span> contratos
                    </button>
                </div>
                <button class="action-btn" id="exportBtn" disabled title="Selecciona contratos para exportar">
                    <span>üì§</span> Exportar
                </button>
                <button class="action-btn primary" id="createBtn">
                    <span>+</span> Crear Contrato
                </button>
            </div>
        </div>

        <!-- List date filter -->
        <div class="list-date-filter" style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding: 12px 16px; background: #f7fafc; border-radius: 8px; flex-wrap: wrap;">
            <span style="font-size: 13px; font-weight: 600; color: #4a5568;">üìÖ Filtrar por fecha:</span>
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-size: 12px; color: #718096;">Desde</label>
                <input type="date" id="listDateFrom" style="padding: 6px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px;">
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-size: 12px; color: #718096;">Hasta</label>
                <input type="date" id="listDateTo" style="padding: 6px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px;">
            </div>
            <button id="applyDateFilter" class="action-btn" style="padding: 6px 12px; font-size: 12px;">Aplicar</button>
            <button id="clearDateFilter" class="action-btn" style="padding: 6px 12px; font-size: 12px;">Limpiar</button>
            <div style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
                <label style="font-size: 12px; color: #718096;">Ver</label>
                <select id="itemsPerPage" style="padding: 6px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px;">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span style="font-size: 12px; color: #718096;">por p√°gina</span>
            </div>
        </div>

        <!-- Tab filters -->
        <div class="contracts-filters">
            <div class="tab-buttons">
                <button class="tab-btn active" data-filter="all">Todos</button>
                <button class="tab-btn" data-filter="tramitado">En Tramitaci√≥n</button>
                <button class="tab-btn" data-filter="oportunidad">Oportunidad</button>
                <button class="tab-btn" data-filter="activado">Activados</button>
                <button class="tab-btn" data-filter="baja">Bajas</button>
            </div>
            <div class="search-filters">
                <div class="search-input">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Buscar cliente, CUPS, comercializadora...">
                </div>
                <button class="filters-btn">
                    <span>‚ò∞</span> Filtros
                </button>
            </div>
        </div>

        <!-- Contracts table -->
        <div class="contracts-table-container">
            <table class="contracts-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="selectAll" style="cursor: pointer;">
                        </th>
                        <th class="sortable" data-sort="id">
                            ID
                            <span class="sort-icon">‚Üï</span>
                        </th>
                        <th class="sortable" data-sort="cliente">
                            Cliente
                            <span class="sort-icon">‚Üï</span>
                        </th>
                        <th class="sortable" data-sort="estado">
                            Estado
                            <span class="sort-icon">‚Üï</span>
                        </th>
                        <th class="sortable" data-sort="tipo">
                            Tipo
                            <span class="sort-icon">‚Üï</span>
                        </th>
                        <th class="sortable" data-sort="tarifa_acceso">
                            Tarifa
                            <span class="sort-icon">‚Üï</span>
                        </th>
                        <th class="sortable" data-sort="consumo">
                            Consumo
                            <span class="sort-icon">‚Üï</span>
                        </th>
                        <th>CUPS</th>
                        <th class="sortable active desc" data-sort="fecha">
                            Fecha
                            <span class="sort-icon">‚Üì</span>
                        </th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="contractsTableBody">
                    <tr>
                        <td colspan="10" class="empty-state">Cargando contratos...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Empty state -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">üìã</div>
            <h3>No hay contratos</h3>
            <p>No se encontraron contratos para este comercial.</p>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination" style="display: none;">
            <div class="pagination-info">
                <span id="paginationInfo">1 of 1</span>
                <span style="margin-left: 16px; color: #718096; font-size: 12px;" id="loadedInfo">Mostrando 0 de 0</span>
            </div>
            <div class="pagination-controls" style="display: flex; align-items: center; gap: 12px;">
                <button class="pagination-btn" id="prevPage" disabled>&lt;</button>
                <button class="pagination-btn" id="nextPage">Avanzar</button>
            </div>
        </div>
    </div>

    <!-- Contract Detail Modal -->
    <div id="contractDetailModal" class="contract-detail-modal">
        <div class="contract-detail-overlay" id="contractDetailOverlay"></div>
        <div class="contract-detail-container">
            <div class="contract-detail-header">
                <button class="back-btn" id="closeContractDetailBtn">
                    ‚Üê Volver
                </button>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <button class="action-btn primary" id="renovarContractBtn" style="display: none;">
                        üîÑ RENOVAR
                    </button>
                    <div class="contract-id-badge" id="modalContractId">ID: -</div>
                </div>
            </div>
            <div id="contractDetailLoading" class="contract-detail-loading">
                <div class="loading-spinner"></div>
                <p>Cargando detalles...</p>
            </div>
            <div id="contractDetailError" class="contract-detail-error">
                <span>‚ö†Ô∏è</span>
                <p id="contractDetailErrorText">Error al cargar</p>
            </div>
            <div id="contractDetailContent" class="contract-detail-content">
                <!-- Tabs -->
                <div class="detail-tabs" style="display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px;">
                    <button class="detail-tab active" data-tab="details">Detalles</button>
                    <button class="detail-tab" data-tab="documentacion">Documentacion</button>
                    <button class="detail-tab" data-tab="historico">Historico</button>
                </div>

                <!-- Tab Content: Details -->
                <div class="detail-tab-content active" data-tab-content="details">
                    <div class="detail-section">
                        <h4>üë§ Datos Personales</h4>
                        <div class="detail-grid">
                            <div class="detail-field"><label>Nombre</label><div class="field-value" id="detailNombre">-</div></div>
                            <div class="detail-field"><label>Tipo</label><div class="field-value" id="detailTipoCliente">-</div></div>
                            <div class="detail-field"><label>Email</label><div class="field-value" id="detailCorreo">-</div></div>
                            <div class="detail-field"><label>M√≥vil</label><div class="field-value" id="detailMovil">-</div></div>
                            <div class="detail-field"><label>DNI/NIF</label><div class="field-value" id="detailDNI">-</div></div>
                            <div class="detail-field"><label>IBAN</label><div class="field-value" id="detailIBAN">-</div></div>
                            <div class="detail-field full-width"><label>Direcci√≥n</label><div class="field-value" id="detailDireccion">-</div></div>
                            <div class="detail-field"><label>CP</label><div class="field-value" id="detailCP">-</div></div>
                            <div class="detail-field"><label>Poblaci√≥n</label><div class="field-value" id="detailPoblacion">-</div></div>
                            <div class="detail-field"><label>Provincia</label><div class="field-value" id="detailProvincia">-</div></div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>üè¢ Datos de Suministro</h4>
                        <div class="detail-grid">
                            <div class="detail-field full-width"><label>CUPS</label><div class="field-value cups-value" id="detailCUPS">-</div></div>
                            <div class="detail-field full-width"><label>Comercializadora Saliente</label><div class="field-value" id="detailComercializadoraSaliente">-</div></div>
                            <div class="detail-field"><label>Persona Contacto</label><div class="field-value" id="detailPersonaContacto">-</div></div>
                            <div class="detail-field"><label>DNI Contacto</label><div class="field-value" id="detailPersonaContactoNIF">-</div></div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>üìã Datos de Contrataci√≥n</h4>
                        <div class="detail-grid">
                            <div class="detail-field full-width"><label>Estado</label><div class="field-value" id="detailEstado">-</div></div>
                            <div class="detail-field"><label>Comercializadora</label><div class="field-value" id="detailComercializadora">-</div></div>
                            <div class="detail-field"><label>Tarifa de Acceso</label><div class="field-value" id="detailTarifaAcceso">-</div></div>
                            <div class="detail-field full-width"><label>Producto</label><div class="field-value" id="detailConcepto">-</div></div>
                            <div class="detail-field"><label>Fecha Activaci√≥n</label><div class="field-value" id="detailFechaActivacion">-</div></div>
                            <div class="detail-field"><label>Tipo</label><div class="field-value" id="detailTipoContratacion">-</div></div>
                        </div>
                    </div>
                    <div class="detail-section" data-section="power-consumption">
                        <!-- Power and consumption data will be populated here by JavaScript -->
                    </div>
                </div>

                <!-- Tab Content: Documentacion -->
                <div class="detail-tab-content" data-tab-content="documentacion">
                    <div class="detail-section">
                        <h4>üìÑ Documentos del Contrato</h4>
                        <p>Los documentos se mostrar√°n aqu√≠</p>
                    </div>
                </div>

                <!-- Tab Content: Historico -->
                <div class="detail-tab-content" data-tab-content="historico">
                    <div class="detail-section">
                        <h4>üìã Historial de Cambios</h4>
                        <p>El historial se mostrar√° aqu√≠</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Contract Modal -->
    <div id="createContractModal" class="contract-detail-modal">
        <div class="contract-detail-overlay" id="createContractOverlay"></div>
        <div class="contract-detail-container">
            <div class="contract-detail-header">
                <button class="back-btn" id="backFromCreateBtn">‚Üê Volver</button>
                <div class="contract-id-badge" style="background: #38a169;"><span>‚ú®</span> Nuevo Contrato</div>
            </div>
            <div class="contract-detail-content" style="display: block;">
                <form id="createContractForm">
                    <div class="detail-section">
                        <h4>Datos Personales</h4>
                        <div class="detail-grid">
                            <div class="detail-field"><label>Nombre Completo *</label><input type="text" name="nombre_cliente" class="form-input" required></div>
                            <div class="detail-field">
                                <label>Tipo de Cliente *</label>
                                <select name="tipo_empresa" class="form-input" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="PARTICULAR">Particular</option>
                                    <option value="AUTONOMO">Aut√≥nomo</option>
                                    <option value="EMPRESA">Empresa</option>
                                    <option value="CCPP">CCPP</option>
                                </select>
                            </div>
                            <div class="detail-field"><label>Email *</label><input type="email" name="email" class="form-input" required></div>
                            <div class="detail-field"><label>M√≥vil *</label><input type="tel" name="movil" class="form-input" required></div>
                            <div class="detail-field"><label>DNI/NIF/CIF *</label><input type="text" name="nif" class="form-input" required></div>
                            <div class="detail-field"><label>IBAN</label><input type="text" name="iban_contrato" class="form-input" placeholder="ES00..."></div>
                            <div class="detail-field full-width"><label>Direcci√≥n Fiscal</label><input type="text" name="direccion" class="form-input"></div>
                            <div class="detail-field"><label>CP</label><input type="text" name="cp" class="form-input" maxlength="5"></div>
                            <div class="detail-field"><label>Poblaci√≥n</label><input type="text" name="poblacion" class="form-input"></div>
                            <div class="detail-field"><label>Provincia</label><input type="text" name="provincia" class="form-input"></div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>Datos de Suministro</h4>
                        <div class="detail-grid">
                            <div class="detail-field full-width"><label><input type="checkbox" id="sameAsPersonal"> Mismos datos que titular</label></div>
                            <div class="detail-field"><label>Persona Contacto</label><input type="text" name="persona_contacto" class="form-input"></div>
                            <div class="detail-field"><label>DNI Contacto</label><input type="text" name="persona_contacto_nif" class="form-input"></div>
                            <div class="detail-field"><label>Comercializadora Saliente</label><input type="text" name="comercializadora_saliente" class="form-input"></div>
                            <div class="detail-field full-width"><label>Direcci√≥n Suministro</label><input type="text" name="direccion_suministro" class="form-input"></div>
                            <div class="detail-field"><label>CP</label><input type="text" name="cp_suministro" class="form-input" maxlength="5"></div>
                            <div class="detail-field"><label>Poblaci√≥n</label><input type="text" name="poblacion_suministro" class="form-input"></div>
                            <div class="detail-field"><label>Provincia</label><input type="text" name="provincia_suministro" class="form-input"></div>
                            <div class="detail-field full-width">
                                <label>CUPS *</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" name="cups" id="cupsInput" class="form-input" required maxlength="22" placeholder="ES0000..." style="flex: 1;">
                                    <button type="button" class="action-btn" id="extractSipsBtn" style="white-space: nowrap;">üìä Extraer SIPS</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>Datos de Contrataci√≥n</h4>
                        <div class="detail-grid">
                            <div class="detail-field">
                                <label>Comercializadora *</label>
                                <select name="comercializadora" class="form-input" required id="createComercializadora"><option value="">Cargando...</option></select>
                            </div>
                            <div class="detail-field">
                                <label>Producto</label>
                                <select name="concepto" class="form-input" id="createProducto" disabled><option value="">Seleccionar primero...</option></select>
                            </div>
                            <div class="detail-field">
                                <label>Tarifa de Acceso *</label>
                                <select name="tarifa_acceso" class="form-input" required id="createTarifaAcceso">
                                    <option value="">Seleccionar...</option>
                                    <option value="2.0TD">2.0TD</option>
                                    <option value="3.0TD">3.0TD</option>
                                    <option value="6.1TD">6.1TD</option>
                                    <option value="RL.1">RL.1</option>
                                    <option value="RL.2">RL.2</option>
                                    <option value="RL.3">RL.3</option>
                                </select>
                            </div>
                            <div class="detail-field"><label>CNAE</label><input type="text" name="cnae_actividad" class="form-input"></div>
                            <div class="detail-field">
                                <label>Consumo Anual (kWh)</label>
                                <input type="number" step="0.01" name="consumo" class="form-input">
                            </div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>Observaciones</h4>
                        <textarea name="observaciones" class="form-textarea" rows="4" placeholder="Notas..."></textarea>
                    </div>
                    <div class="form-actions" style="display: flex; gap: 12px; padding: 20px 0; border-top: 1px solid #e2e8f0; margin-top: 20px;">
                        <button type="button" class="action-btn" id="cancelCreateBtn">Cancelar</button>
                        <button type="submit" class="action-btn primary" style="flex: 1;" id="submitCreateBtn"><span>‚ú®</span> Crear Contrato</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Load CSS from GitHub via RawGit alternative (githack.com) -->
<link rel="stylesheet" href="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/styles.css">

<!-- Load JavaScript modules from GitHub via RawGit alternative (githack.com) -->
<script src="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/config.js"></script>
<script src="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/state.js"></script>
<script src="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/utils.js"></script>
<script src="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/api.js"></script>
<script src="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/ui.js"></script>
<script src="https://raw.githack.com/pedrokrug/micro_crm_tunergia/claude/refactor-crm-code-blocks-K3Cix/src/main.js"></script>

<!--
   ‚úÖ COMPLETE VERSION v1.0.9 - All functionality restored

   NOW USING: raw.githack.com (serves files with proper MIME types)

   WHY: jsDelivr was returning 403 errors, raw.githubusercontent.com serves
   files as text/plain (browsers won't execute). Githack.com properly serves
   JavaScript and CSS with correct Content-Type headers.

   FIXED ISSUES:
   ‚úÖ Contracts can now open (modal HTML added)
   ‚úÖ Create Contract button works
   ‚úÖ RENOVAR button works
   ‚úÖ Gmail-style select all logic works
   ‚úÖ Oportunidad filter logic and colors work
   ‚úÖ Files now load with proper MIME types

   Repository: https://github.com/pedrokrug/micro_crm_tunergia
   Branch: claude/refactor-crm-code-blocks-K3Cix
-->
